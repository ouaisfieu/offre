<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUI-EST-CE ? (impossible)</title>

<style>
:root {
  --bg: #05060a;
  --neon: #7df9ff;
  --danger: #ff4d4d;
  --ok: #9dff9d;
  --text: #e6e6e6;
  --glass: rgba(255,255,255,0.08);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #0b0f2b, var(--bg));
  color: var(--text);
  font-family: system-ui, sans-serif;
  overflow-x: hidden;
}

header {
  padding: 1.5rem;
  text-align: center;
}

h1 {
  font-size: clamp(1.8rem, 4vw, 3rem);
  color: var(--neon);
  text-shadow: 0 0 20px var(--neon);
}

.subtitle {
  opacity: 0.7;
  font-size: 0.95rem;
}

#universe {
  position: fixed;
  inset: 0;
  z-index: -1;
}

main {
  padding: 1rem;
  max-width: 1100px;
  margin: auto;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
  gap: 1rem;
}

.card {
  background: linear-gradient(145deg, var(--glass), transparent);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 14px;
  padding: 1rem;
  backdrop-filter: blur(8px);
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
}

.card h2 {
  margin-top: 0;
  font-size: 1.1rem;
  color: var(--neon);
}

.stat {
  font-size: 1.8rem;
  font-weight: bold;
}

.label {
  font-size: 0.8rem;
  opacity: 0.6;
}

button {
  width: 100%;
  margin-top: 1rem;
  padding: 0.9rem;
  font-size: 1rem;
  background: transparent;
  border: 1px solid var(--neon);
  color: var(--neon);
  border-radius: 10px;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  background: var(--neon);
  color: #000;
  box-shadow: 0 0 25px var(--neon);
}

#verdict {
  margin-top: 1rem;
  font-size: 0.9rem;
  min-height: 3em;
}

footer {
  text-align: center;
  opacity: 0.4;
  padding: 2rem 1rem;
  font-size: 0.75rem;
}

  .silence-high {
  color: var(--danger);
  text-shadow: 0 0 10px var(--danger);
}

.silence-low {
  color: var(--ok);
}
.meta-danger {
  color: var(--danger);
  text-shadow: 0 0 12px var(--danger);
}

.meta-ok {
  color: var(--ok);
}

.meta-veil {
  opacity: 0.4;
  filter: blur(1px);
}

</style>
</head>

<body>

<canvas id="universe"></canvas>

<header>
  <h1>QUI-EST-CE&nbsp;?</h1>
  <div class="subtitle">
    Une personne. En Belgique. Connue par 9 Ãªtres humains.
  </div>
</header>

<main>
  <section class="grid">

    <div class="card">
      <h2>ğŸŒ Population mondiale</h2>
      <div class="stat" id="worldPop">â€¦</div>
      <div class="label">Ãªtres humains en vie</div>
    </div>

    <div class="card">
      <h2>ğŸŒ Utilisateurs Internet</h2>
      <div class="stat" id="internetUsers">â€¦</div>
      <div class="label">connectÃ©s ou connectables</div>
    </div>

    <div class="card">
      <h2>ğŸ‡§ğŸ‡ª HypothÃ¨se Belgique</h2>
      <div class="stat" id="belgiumChance">â€¦</div>
      <div class="label">probabilitÃ© brute dâ€™identification</div>
    </div>

    <div class="card">
      <h2>ğŸ‘ï¸ Connaissance rÃ©elle</h2>
      <div class="stat">9</div>
      <div class="label">personnes dÃ©tentrices de la vÃ©ritÃ©</div>
    </div>

  </section>

  <div class="card">
  <h2>ğŸœ Organisation silencieuse</h2>
  <div class="stat" id="orgCount">42</div>
  <div class="label">
    personnes liÃ©es par une contrainte de non-divulgation
  </div>
  <div id="silenceLevel" class="label" style="margin-top:0.5rem;">
    niveau de silence : stable
  </div>
</div>

 <div class="card" id="metaSystem">
  <h2>ğŸœ‚ Organisation derriÃ¨re lâ€™organisation</h2>

  <div class="label">
    Une structure non dÃ©clarÃ©e opÃ¨re au-dessus du systÃ¨me connu.
  </div>

  <div style="margin-top:.8rem">
    ğŸ‘ï¸ Veilleur :
    <strong id="watcherStatus">actif</strong>
  </div>

  <div style="margin-top:.4rem">
    ğŸ Infiltration :
    <strong id="infiltrationLevel">indÃ©tectable</strong>
  </div>

  <div style="margin-top:.4rem">
    ğŸ” IntÃ©gritÃ© du secret :
    <strong id="secretIntegrity">100%</strong>
  </div>

  <div class="label" style="margin-top:.6rem">
    Cette couche nâ€™est pas censÃ©e Ãªtre observable.
  </div>
</div>
 

  <section class="card">
    <h2>ğŸ§© Tentative dâ€™identification</h2>
    <button id="guess">TENTER DE ME TROUVER</button>
    <div id="verdict"></div>
  </section>
</main>

<footer>
  Ce <a href="suite/script.html" >[...]</a> observe plus quâ€™il ne rÃ©vÃ¨le <a href="suite/index.html" >[...]</a>.
</footer>

<script>
/* =======================
   STATS TEMPS RÃ‰EL
======================= */

// Sources publiques simples
const WORLD_POP_API = "https://api.worldbank.org/v2/country/WLD/indicator/SP.POP.TOTL?format=json";
const INTERNET_API = "https://api.worldbank.org/v2/indicator/IT.NET.USER.ZS?format=json";

let worldPop = 0;
let internetUsers = 0;
let attempts = 0;

async function fetchWorldPopulation() {
  const res = await fetch(WORLD_POP_API);
  const data = await res.json();
  worldPop = data[1][0].value;
  updateStats();
}

async function fetchInternetUsers() {
  const res = await fetch(INTERNET_API);
  const data = await res.json();
  const percentage = data[1][0].value;
  internetUsers = Math.floor(worldPop * (percentage / 100));
  updateStats();
}

function updateStats() {
  if (!worldPop) return;
  document.getElementById("worldPop").textContent =
    worldPop.toLocaleString("fr-FR");

  document.getElementById("internetUsers").textContent =
    internetUsers.toLocaleString("fr-FR");

  const belgiumPop = 11700000;
  const chance = (9 / belgiumPop) * 100;
  document.getElementById("belgiumChance").textContent =
    chance.toExponential(2) + " %";
}

fetchWorldPopulation().then(fetchInternetUsers);

/* =======================
   LOGIQUE DU JEU
======================= */

const verdicts = [
  "Non. Cette tentative Ã©largit le champ des possibles.",
  "Erreur logique : les donnÃ©es observÃ©es ne convergent pas.",
  "Votre hypothÃ¨se est statistiquement insignifiante.",
  "Plus vous cherchez, plus la cible se dÃ©place.",
  "Les 9 personnes ne sont pas connectÃ©es.",
  "La Belgique est trop grande. Lâ€™humain trop flou.",
  "Indice valide, conclusion impossible.",
  "Ce systÃ¨me ne connaÃ®t que des probabilitÃ©s."
];

document.getElementById("guess").onclick = () => {
  attempts++;
  const msg = verdicts[Math.floor(Math.random()*verdicts.length)];
  document.getElementById("verdict").innerHTML =
    `<strong>Tentative #${attempts}</strong><br>${msg}`;
};

  let silence = 0;

const silenceMessages = [
  "stable",
  "surveillÃ©",
  "sous contrainte",
  "verrouillÃ©",
  "total"
];

function updateSilence() {
  const level = Math.min(silence, silenceMessages.length - 1);
  const el = document.getElementById("silenceLevel");

  el.textContent = "niveau de silence : " + silenceMessages[level];

  if (level >= 3) {
    el.classList.add("silence-high");
    el.classList.remove("silence-low");
  } else {
    el.classList.add("silence-low");
    el.classList.remove("silence-high");
  }
}

// injection dans la tentative existante
const originalGuess = document.getElementById("guess").onclick;

document.getElementById("guess").onclick = () => {
  silence++;
  updateSilence();
  originalGuess();
};

  /* ====== PHASE MÃ‰TA ====== */

let secretIntegrity = 100;
let infiltration = 0;
let watcherAlert = false;

// rÃ©fÃ©rences UI
const watcherEl = document.getElementById("watcherStatus");
const infiltrationEl = document.getElementById("infiltrationLevel");
const integrityEl = document.getElementById("secretIntegrity");
const metaSystem = document.getElementById("metaSystem");

// logique interne invisible
function metaTick() {
  // l'infiltrateur progresse lentement mais sÃ»rement
  infiltration += Math.random() * 2;

  // le veilleur agit uniquement si le secret est menacÃ©
  if (secretIntegrity < 70) {
    watcherAlert = true;
    infiltration *= 0.85; // contre-mesure
    secretIntegrity += 1.5;
  }

  // chaque tentative publique fragilise le secret
  secretIntegrity -= Math.random() * 1.2;

  // bornes
  infiltration = Math.min(infiltration, 100);
  secretIntegrity = Math.max(Math.min(secretIntegrity, 100), 0);

  updateMetaUI();
}

function updateMetaUI() {
  // infiltration
  let infilLabel = "indÃ©tectable";
  if (infiltration > 30) infilLabel = "latente";
  if (infiltration > 60) infilLabel = "active";
  if (infiltration > 85) infilLabel = "critique";

  infiltrationEl.textContent = infilLabel;

  // veilleur
  watcherEl.textContent = watcherAlert ? "en vigilance absolue" : "actif";

  // intÃ©gritÃ©
  integrityEl.textContent = Math.round(secretIntegrity) + "%";

  // Ã©tats visuels
  integrityEl.className = secretIntegrity < 40 ? "meta-danger" : "meta-ok";

  // si trop proche de la vÃ©ritÃ© â†’ voile
  if (secretIntegrity < 25) {
    metaSystem.classList.add("meta-veil");
  } else {
    metaSystem.classList.remove("meta-veil");
  }

  // rÃ¨gle d'or : si l'infiltrateur gagne trop
  if (infiltration > 90 && secretIntegrity < 30) {
    lockReality();
  }
}

// verrouillage narratif
function lockReality() {
  document.getElementById("verdict").innerHTML =
    "<strong>âš ï¸ INCIDENT MÃ‰TA</strong><br>" +
    "Une intervention hors-systÃ¨me a neutralisÃ© cette tentative.";

  // dÃ©sactivation douce
  document.getElementById("guess").disabled = true;
  document.getElementById("guess").textContent = "ACCÃˆS RÃ‰VOQUÃ‰";
}

// injection dans le bouton existant
const previousGuess = document.getElementById("guess").onclick;
document.getElementById("guess").onclick = () => {
  metaTick();
  previousGuess();
};

// tick passif (le systÃ¨me vit sans le joueur)
setInterval(metaTick, 12000);


/* =======================
   FOND COSMIQUE ANIMÃ‰
======================= */

const canvas = document.getElementById("universe");
const ctx = canvas.getContext("2d");
let stars = [];

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

for (let i = 0; i < 200; i++) {
  stars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*1.5 + 0.2,
    v: Math.random()*0.2 + 0.05
  });
}

function animate() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "#7df9ff";
  stars.forEach(s => {
    s.y += s.v;
    if (s.y > canvas.height) s.y = 0;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
